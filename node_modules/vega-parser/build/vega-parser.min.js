!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("vega-util"),require("vega-expression"),require("vega-functions"),require("vega-event-selector"),require("vega-scale"),require("vega-dataflow")):"function"==typeof define&&define.amd?define(["exports","vega-util","vega-expression","vega-functions","vega-event-selector","vega-scale","vega-dataflow"],t):t((e=e||self).vega={},e.vega,e.vega,e.vega,e.vega,e.vega,e.vega)}(this,(function(e,t,n,i,a,r,l){"use strict";function o(e){return+e||0}var s=["value","update","init","react","bind"];function u(e,n){t.error(e+' for "outer" push: '+t.stringValue(n))}function d(e,t){var n=e.name;if("outer"===e.push)t.signals[n]||u("No prior signal definition",n),s.forEach((function(t){void 0!==e[t]&&u("Invalid property ",t)}));else{var i=t.addSignal(n,e.value);!1===e.react&&(i.react=!1),e.bind&&t.addBinding(n,e.bind)}}function c(e,a,r){var l,o,s={};try{e=t.isString(e)?e:t.stringValue(e)+"",l=n.parse(e)}catch(n){t.error("Expression parse error: "+e)}return l.visit((function(e){if(e.type===n.CallExpression){var t=e.callee.name,r=i.codegenParams.visitors[t];r&&r(t,e.arguments,a,s)}})),(o=i.codeGenerator(l)).globals.forEach((function(e){var n=i.SignalPrefix+e;!t.hasOwnProperty(s,n)&&a.getSignal(e)&&(s[n]=a.signalRef(e))})),{$expr:r?r+"return("+o.code+");":o.code,$fields:o.fields,$params:s}}function f(e,t,n,i){this.id=-1,this.type=e,this.value=t,this.params=n,i&&(this.parent=i)}function g(e,t,n,i){return new f(e,t,n,i)}function p(e,t){return g("operator",e,t)}function m(e){var t={$ref:e.id};return e.id<0&&(e.refs=e.refs||[]).push(t),t}function h(e,t){return t?{$field:e,$name:t}:{$field:e}}var y=h("key");function b(e,t){return{$compare:e,$order:t}}function v(e,t){return(e&&e.signal?"$"+e.signal:e||"")+(e&&t?"_":"")+(t&&t.signal?"$"+t.signal:t||"")}function x(e){return e&&e.signal}function k(e){if(x(e))return!0;if(t.isObject(e))for(var n in e)if(k(e[n]))return!0;return!1}function S(e,t){return null!=e?e:t}function $(e){return e&&e.signal||e}function O(e,n){return(e.merge?R:e.stream?z:e.type?w:t.error("Invalid stream specification: "+t.stringValue(e)))(e,n)}function R(e,t){var n=j({merge:e.merge.map(e=>O(e,t))},e,t);return t.addStream(n).id}function z(e,t){var n=j({stream:O(e.stream,t)},e,t);return t.addStream(n).id}function w(e,t){var n,i,a;return"timer"===e.type?(n=t.event("timer",e.throttle),e={between:e.between,filter:e.filter}):n=t.event("scope"===(a=e.source)?"view":a||"view",e.type),i=j({stream:n},e,t),1===Object.keys(i).length?n:t.addStream(i).id}function j(e,n,i){var a,r,l,o,s=n.between;return s&&(2!==s.length&&t.error('Stream "between" parameter must have 2 entries: '+t.stringValue(n)),e.between=[O(s[0],i),O(s[1],i)]),s=n.filter?[].concat(n.filter):[],(n.marktype||n.markname||n.markrole)&&s.push((a=n.marktype,r=n.markname,l=n.markrole,(o="event.item")+(a&&"*"!==a?"&&"+o+".mark.marktype==='"+a+"'":"")+(l?"&&"+o+".mark.role==='"+l+"'":"")+(r?"&&"+o+".mark.name==='"+r+"'":""))),"scope"===n.source&&s.push("inScope(event.item)"),s.length&&(e.filter=c("("+s.join(")&&(")+")").$expr),null!=(s=n.throttle)&&(e.throttle=+s),null!=(s=n.debounce)&&(e.debounce=+s),n.consume&&(e.consume=!0),e}var P="var datum=event.item&&event.item.datum;";function D(e,n,i){var r=e.events,l=e.update,o=e.encode,s=[],u={target:i};r||t.error("Signal update missing events specification."),t.isString(r)&&(r=a.selector(r,n.isSubscope()?"scope":"view")),r=t.array(r).filter(e=>e.signal||e.scale?(s.push(e),0):1),s.length>1&&(s=[V(s)]),r.length&&s.push(r.length>1?{merge:r}:r[0]),null!=o&&(l&&t.error("Signal encode and update are mutually exclusive."),l="encode(item(),"+t.stringValue(o)+")"),u.update=t.isString(l)?c(l,n,P):null!=l.expr?c(l.expr,n,P):null!=l.value?l.value:null!=l.signal?{$expr:"_.value",$params:{value:n.signalRef(l.signal)}}:t.error("Invalid signal update specification."),e.force&&(u.options={force:!0}),s.forEach((function(e){n.addUpdate(t.extend(function(e,t){return{source:e.signal?t.signalRef(e.signal):e.scale?t.scaleRef(e.scale):O(e,t)}}(e,n),u))}))}function V(e){return{signal:"["+e.map(e=>e.scale?'scale("'+e.scale+'")':e.signal)+"]"}}function W(e,n){var i=n.getSignal(e.name),a=e.update;e.init&&(a?t.error("Signals can not include both init and update expressions."):(a=e.init,i.initonly=!0)),a&&(a=c(a,n),i.update=a.$expr,i.params=a.$params),e.on&&e.on.forEach((function(e){D(e,n,i.id)}))}function _(e){return function(t,n,i){return g(e,n,t||void 0,i)}}var C=_("aggregate"),L=_("axisticks"),E=_("bound"),A=_("collect"),F=_("compare"),T=_("datajoin"),B=_("encode"),q=_("expression"),M=_("facet"),U=_("field"),H=_("key"),I=_("legendentries"),N=_("load"),G=_("mark"),X=_("multiextent"),Y=_("multivalues"),Q=_("overlap"),J=_("params"),K=_("prefacet"),Z=_("projection"),ee=_("proxy"),te=_("relay"),ne=_("render"),ie=_("scale"),ae=_("sieve"),re=_("sortitems"),le=_("viewlayout"),oe=_("values"),se=0,ue={min:"min",max:"max",count:"sum"};function de(e,n){var i,a,l=n.getScale(e.name).params;for(i in l.domain=pe(e.domain,e,n),null!=e.range&&(l.range=function e(n,i,a){var l=n.range,o=i.config.range;if(l.signal)return i.signalRef(l.signal);if(t.isString(l)){if(o&&t.hasOwnProperty(o,l))return n=t.extend({},n,{range:o[l]}),e(n,i,a);"width"===l?l=[0,{signal:"width"}]:"height"===l?l=r.isDiscrete(n.type)?[0,{signal:"height"}]:[{signal:"height"},0]:t.error("Unrecognized scale range value: "+t.stringValue(l))}else{if(l.scheme)return a.scheme=t.isArray(l.scheme)?fe(l.scheme,i):ce(l.scheme,i),l.extent&&(a.schemeExtent=fe(l.extent,i)),void(l.count&&(a.schemeCount=ce(l.count,i)));if(l.step)return void(a.rangeStep=ce(l.step,i));if(r.isDiscrete(n.type)&&!t.isArray(l))return pe(l,n,i);t.isArray(l)||t.error("Unsupported range type: "+t.stringValue(l))}return l.map(e=>(t.isArray(e)?fe:ce)(e,i))}(e,n,l)),null!=e.interpolate&&function(e,t){t.interpolate=ce(e.type||e),null!=e.gamma&&(t.interpolateGamma=ce(e.gamma))}(e.interpolate,l),null!=e.nice&&(l.nice=(a=e.nice,t.isObject(a)?{interval:ce(a.interval),step:ce(a.step)}:ce(a))),null!=e.bins&&(l.bins=function(e,n){return e.signal||t.isArray(e)?fe(e,n):n.objectProperty(e)}(e.bins,n)),e)t.hasOwnProperty(l,i)||"name"===i||(l[i]=ce(e[i],n))}function ce(e,n){return t.isObject(e)?e.signal?n.signalRef(e.signal):t.error("Unsupported object: "+t.stringValue(e)):e}function fe(e,t){return e.signal?t.signalRef(e.signal):e.map(e=>ce(e,t))}function ge(e){t.error("Can not find data set: "+t.stringValue(e))}function pe(e,n,i){if(e)return e.signal?i.signalRef(e.signal):(t.isArray(e)?me:e.fields?ye:he)(e,n,i);null==n.domainMin&&null==n.domainMax||t.error("No scale domain defined for domainMin/domainMax to override.")}function me(e,t,n){return e.map((function(e){return ce(e,n)}))}function he(e,t,n){var i=n.getData(e.data);return i||ge(e.data),r.isDiscrete(t.type)?i.valuesRef(n,e.field,ve(e.sort,!1)):r.isQuantile(t.type)?i.domainRef(n,e.field):i.extentRef(n,e.field)}function ye(e,n,i){var a=e.data,l=e.fields.reduce((function(e,n){return n=t.isString(n)?{data:a,field:n}:t.isArray(n)||n.signal?function(e,n){var i="_:vega:_"+se++,a=A({});if(t.isArray(e))a.value={$ingest:e};else if(e.signal){var r="setdata("+t.stringValue(i)+","+e.signal+")";a.params.input=n.signalRef(r)}return n.addDataPipeline(i,[a,ae({})]),{data:i,field:"data"}}(n,i):n,e.push(n),e}),[]);return(r.isDiscrete(n.type)?be:r.isQuantile(n.type)?xe:ke)(e,i,l)}function be(e,t,n){var i,a,r,l,o,s=ve(e.sort,!0);return i=n.map((function(e){var n=t.getData(e.data);return n||ge(e.data),n.countsRef(t,e.field,s)})),a={groupby:y,pulse:i},s&&(r=s.op||"count",o=s.field?v(r,s.field):"count",a.ops=[ue[r]],a.fields=[t.fieldRef(o)],a.as=[o]),r=t.add(C(a)),l=t.add(A({pulse:m(r)})),o=t.add(oe({field:y,sort:t.sortRef(s),pulse:m(l)})),m(o)}function ve(e,n){return e&&(e.field||e.op?e.field||"count"===e.op?n&&e.field&&e.op&&!ue[e.op]&&t.error("Multiple domain scales can not be sorted using "+e.op):t.error("No field provided for sort aggregate op: "+e.op):t.isObject(e)?e.field="key":e={field:"key"}),e}function xe(e,t,n){var i=n.map((function(e){var n=t.getData(e.data);return n||ge(e.data),n.domainRef(t,e.field)}));return m(t.add(Y({values:i})))}function ke(e,t,n){var i=n.map((function(e){var n=t.getData(e.data);return n||ge(e.data),n.extentRef(t,e.field)}));return m(t.add(X({extents:i})))}function Se(e,n,i){return t.isArray(e)?e.map((function(e){return Se(e,n,i)})):t.isObject(e)?e.signal?i.signalRef(e.signal):"fit"===n?e:t.error("Unsupported parameter object: "+t.stringValue(e)):e}const $e="top",Oe="left",Re="value",ze=["size","shape","fill","stroke","strokeWidth","strokeDash","opacity"],we={name:1,style:1,interactive:1},je={value:0},Pe={value:1};var De=t.toSet(["rule"]),Ve=t.toSet(["group","image","rect"]);function We(e,n,i,a){var r=c(e,n);return r.$fields.forEach((function(e){a[e]=1})),t.extend(i,r.$params),r.$expr}function _e(e,n,i,a){return function e(n,i,a,r){var l,o,s;if(n.signal)l="datum",s=We(n.signal,i,a,r);else if(n.group||n.parent){for(o=Math.max(1,n.level||1),l="item";o-- >0;)l+=".mark.group";n.parent?(s=n.parent,l+=".datum"):s=n.group}else n.datum?(l="datum",s=n.datum):t.error("Invalid field reference: "+t.stringValue(n));n.signal||(t.isString(s)?(r[s]=1,s=t.splitAccessPath(s).map(t.stringValue).join("][")):s=e(s,i,a,r));return l+"["+s+"]"}(t.isObject(e)?e:{datum:e},n,i,a)}function Ce(e,n,i,a){return t.isObject(e)?"("+Ae(null,e,n,i,a)+")":e}function Le(e,n,i,a,r){var l,o,s,u=Ee(e.scale,i,a,r);return null!=e.range?(o=u+".range()",n=0===(l=+e.range)?o+"[0]":"($="+o+","+(1===l?"$[$.length-1]":"$[0]+"+l+"*($[$.length-1]-$[0])")+")"):(void 0!==n&&(n=u+"("+n+")"),e.band&&(s=function(e,n){if(!t.isString(e))return-1;var i=n.scaleType(e);return"band"===i||"point"===i?1:0}(e.scale,i))&&(o=u+".bandwidth",l=e.band.signal?o+"()*"+Ce(e.band,i,a,r):o+"()"+(1===(l=+e.band)?"":"*"+l),s<0&&(l="("+o+"?"+l+":0)"),n=(n?n+"+":"")+l,e.extra&&(n="(datum.extra?"+u+"(datum.extra.value):"+n+")")),null==n&&(n="0")),n}function Ee(e,n,a,r){var l;if(t.isString(e))l=i.ScalePrefix+e,t.hasOwnProperty(a,l)||(a[l]=n.scaleRef(e)),l=t.stringValue(l);else{for(l in n.scales)a[i.ScalePrefix+l]=n.scaleRef(l);l=t.stringValue(i.ScalePrefix)+"+"+(e.signal?"("+We(e.signal,n,a,r)+")":_e(e,n,a,r))}return"_["+l+"]"}function Ae(e,n,i,a,r){if(null!=n.gradient)return function(e,n,i,a){return"this.gradient("+Ee(e.gradient,n,i,a)+","+t.stringValue(e.start)+","+t.stringValue(e.stop)+","+t.stringValue(e.count)+")"}(n,i,a,r);var l=n.signal?We(n.signal,i,a,r):n.color?function(e,t,n,i){function a(e,a,r,l){return"this."+e+"("+[Ae(null,a,t,n,i),Ae(null,r,t,n,i),Ae(null,l,t,n,i)].join(",")+").toString()"}return e.c?a("hcl",e.h,e.c,e.l):e.h||e.s?a("hsl",e.h,e.s,e.l):e.l||e.a?a("lab",e.l,e.a,e.b):e.r||e.g||e.b?a("rgb",e.r,e.g,e.b):null}(n.color,i,a,r):null!=n.field?_e(n.field,i,a,r):void 0!==n.value?t.stringValue(n.value):void 0;return null!=n.scale&&(l=Le(n,l,i,a,r)),void 0===l&&(l=null),null!=n.exponent&&(l="Math.pow("+l+","+Ce(n.exponent,i,a,r)+")"),null!=n.mult&&(l+="*"+Ce(n.mult,i,a,r)),null!=n.offset&&(l+="+"+Ce(n.offset,i,a,r)),n.round&&(l="Math.round("+l+")"),l}function Fe(e,n,i){const a=e+"["+t.stringValue(n)+"]";return`$=${i};if(${a}!==$)${a}=$,m=1;`}function Te(e,n,i,a,r){var l="";return n.forEach((function(e){var t=Ae(0,e,i,a,r);l+=e.test?We(e.test,i,a,r)+"?"+t+":":t})),":"===t.peek(l)&&(l+="null"),Fe("o",e,l)}function Be(e,n,i,a){var r,l,o={},s="var o=item,datum=o.datum,m=0,$;";for(r in e)l=e[r],t.isArray(l)?s+=Te(r,l,a,i,o):s+=Fe("o",r,Ae(0,l,a,i,o));return s+=function(e,t){var n="";return De[t]||(e.x2&&(e.x?(Ve[t]&&(n+="if(o.x>o.x2)$=o.x,o.x=o.x2,o.x2=$;"),n+="o.width=o.x2-o.x;"):n+="o.x=o.x2-(o.width||0);"),e.xc&&(n+="o.x=o.xc-(o.width||0)/2;"),e.y2&&(e.y?(Ve[t]&&(n+="if(o.y>o.y2)$=o.y,o.y=o.y2,o.y2=$;"),n+="o.height=o.y2-o.y;"):n+="o.y=o.y2-(o.height||0);"),e.yc&&(n+="o.y=o.yc-(o.height||0)/2;")),n}(e,n),{$expr:s+="return m;",$fields:Object.keys(o),$output:Object.keys(e)}}function qe(e){return t.isObject(e)&&!t.isArray(e)?t.extend({},e):{value:e}}function Me(e,n,i,a){return null!=i?(t.isObject(i)&&!t.isArray(i)?e.update[n]=i:e[a||"enter"][n]={value:i},1):0}function Ue(e,t,n){for(let n in t)Me(e,n,t[n]);for(let t in n)Me(e,t,n[t],"update")}function He(e,n,i){for(var a in n)i&&t.hasOwnProperty(i,a)||(e[a]=t.extend(e[a]||{},n[a]));return e}function Ie(e,n,i,a,r,l){var o,s;for(s in(l=l||{}).encoders={$encode:o={}},e=function(e,n,i,a,r){var l,o,s,u={},d={};"legend"!=i&&0!==String(i).indexOf("axis")||(i=null);for(o in s="frame"===i?r.group:"mark"===i?t.extend({},r.mark,r[n]):null)Ge(o,e)||("fill"===o||"stroke"===o)&&(Ge("fill",e)||Ge("stroke",e))||Ne(u,o,s[o]);for(o in t.array(a).forEach((function(t){var n=r.style&&r.style[t];for(var i in n)Ge(i,e)||Ne(u,i,n[i])})),e=t.extend({},e),u)(s=u[o]).signal?(l=l||{})[o]=s:d[o]=s;e.enter=t.extend(d,e.enter),l&&(e.update=t.extend(l,e.update));return e}(e,n,i,a,r.config))o[s]=Be(e[s],n,l,r);return l}function Ne(e,t,n){e[t]=n&&n.signal?{signal:n.signal}:{value:n}}function Ge(e,t){return t&&(t.enter&&t.enter[e]||t.update&&t.update[e])}function Xe(e,t,n,i,a,r,l){return{type:e,name:l?l.name:void 0,role:t,style:l&&l.style||n,key:i,from:a,interactive:!(!l||!l.interactive),encode:He(r,l,we)}}function Ye(e,t){const n=(n,i)=>S(e[n],S(t[n],i));return n.isVertical=n=>"vertical"===S(e.direction,t.direction||(n?t.symbolDirection:t.gradientDirection)),n.gradientLength=()=>S(e.gradientLength,t.gradientLength||t.gradientWidth),n.gradientThickness=()=>S(e.gradientThickness,t.gradientThickness||t.gradientHeight),n.entryColumns=()=>S(e.columns,S(t.columns,+n.isVertical(!0))),n}function Qe(e,t){var n=t&&(t.update&&t.update[e]||t.enter&&t.enter[e]);return n&&n.signal?n:n?n.value:null}function Je(e,t,n){return`item.anchor === "start" ? ${e} : item.anchor === "end" ? ${t} : ${n}`}const Ke=Je(t.stringValue(Oe),t.stringValue("right"),t.stringValue("center"));function Ze(e,n,i,a){var r,l,o,s,u,d,c=Ye(e,i),f=c.isVertical(),g=c.gradientThickness(),p=c.gradientLength();return f?(o=[0,1],s=[0,0],u=g,d=p):(o=[0,0],s=[1,0],u=p,d=g),Ue(r={enter:l={opacity:je,x:je,y:je,width:qe(u),height:qe(d)},update:t.extend({},l,{opacity:Pe,fill:{gradient:n,start:o,stop:s}}),exit:{opacity:je}},{stroke:c("gradientStrokeColor"),strokeWidth:c("gradientStrokeWidth")},{opacity:c("gradientOpacity")}),Xe("rect","legend-gradient",null,void 0,void 0,r,a)}function et(e,n,i,a,r){var l,o,s,u,d,c,f=Ye(e,i),g=f.isVertical(),p=f.gradientThickness(),m=f.gradientLength(),h="";return g?(s="y",d="y2",u="x",c="width",h="1-"):(s="x",d="x2",u="y",c="height"),(o={opacity:je,fill:{scale:n,field:Re}})[s]={signal:h+"datum.perc",mult:m},o[u]=je,o[d]={signal:h+"datum.perc2",mult:m},o[c]=qe(p),Ue(l={enter:o,update:t.extend({},o,{opacity:Pe}),exit:{opacity:je}},{stroke:f("gradientStrokeColor"),strokeWidth:f("gradientStrokeWidth")},{opacity:f("gradientOpacity")}),Xe("rect","legend-band",null,Re,r,l,a)}function tt(e,t,n,i){var a,r,l,o,s,u=Ye(e,t),d=u.isVertical(),c=qe(u.gradientThickness()),f=u.gradientLength(),g=u("labelOverlap"),p=u("labelSeparation"),m="";return Ue(a={enter:r={opacity:je},update:l={opacity:Pe,text:{field:"label"}},exit:{opacity:je}},{fill:u("labelColor"),fillOpacity:u("labelOpacity"),font:u("labelFont"),fontSize:u("labelFontSize"),fontStyle:u("labelFontStyle"),fontWeight:u("labelFontWeight"),limit:S(e.labelLimit,t.gradientLabelLimit)}),d?(r.align={value:"left"},r.baseline=l.baseline={signal:'datum.perc<=0?"bottom":datum.perc>=1?"top":"middle"'},o="y",s="x",m="1-"):(r.align=l.align={signal:'datum.perc<=0?"left":datum.perc>=1?"right":"center"'},r.baseline={value:"top"},o="x",s="y"),r[o]=l[o]={signal:m+"datum.perc",mult:f},r[s]=l[s]=c,c.offset=S(e.labelOffset,t.gradientLabelOffset)||0,e=Xe("text","legend-label","guide-label",Re,i,a,n),g&&(e.overlap={separation:p,method:g,order:"datum.index"}),e}function nt(e,t,n,i,a,r,l,o){return{type:"group",name:n,role:e,style:t,from:i,interactive:a||!1,encode:r,marks:l,layout:o}}function it(e,t,n,i,a){var r,l,o,s,u,d,c,f=Ye(e,t),g=n.entries,p=!(!g||!g.interactive),m=g?g.name:void 0,h=f("clipHeight"),y=f("symbolOffset"),b={data:"value"},v={},x=`(${a}) ? datum.offset : datum.size`,k=h?qe(h):{field:"size"},S="datum.index",$=`max(1, ${a})`;k.mult=.5,v={enter:r={opacity:je,x:{signal:x,mult:.5,offset:y},y:k},update:l={opacity:Pe,x:r.x,y:r.y},exit:{opacity:je}};var O=null,R=null;return e.fill||(O=t.symbolBaseFillColor,R=t.symbolBaseStrokeColor),Ue(v,{fill:f("symbolFillColor",O),shape:f("symbolType"),size:f("symbolSize"),stroke:f("symbolStrokeColor",R),strokeDash:f("symbolDash"),strokeDashOffset:f("symbolDashOffset"),strokeWidth:f("symbolStrokeWidth")},{opacity:f("symbolOpacity")}),ze.forEach((function(t){e[t]&&(l[t]=r[t]={scale:e[t],field:Re})})),s=Xe("symbol","legend-symbol",null,Re,b,v,n.symbols),h&&(s.clip=!0),(o=qe(y)).offset=f("labelOffset"),Ue(v={enter:r={opacity:je,x:{signal:x,offset:o},y:k},update:l={opacity:Pe,text:{field:"label"},x:r.x,y:r.y},exit:{opacity:je}},{align:f("labelAlign"),baseline:f("labelBaseline"),fill:f("labelColor"),fillOpacity:f("labelOpacity"),font:f("labelFont"),fontSize:f("labelFontSize"),fontStyle:f("labelFontStyle"),fontWeight:f("labelFontWeight"),limit:f("labelLimit")}),u=Xe("text","legend-label","guide-label",Re,b,v,n.labels),v={enter:{noBound:{value:!h},width:je,height:h?qe(h):je,opacity:je},exit:{opacity:je},update:l={opacity:Pe,row:{signal:null},column:{signal:null}}},f.isVertical(!0)?(d=`ceil(item.mark.items.length / ${$})`,l.row.signal=`${S}%${d}`,l.column.signal=`floor(${S} / ${d})`,c={field:["row",S]}):(l.row.signal=`floor(${S} / ${$})`,l.column.signal=`${S} % ${$}`,c={field:S}),l.column.signal=`(${a})?${l.column.signal}:${S}`,(e=nt("scope",null,m,i={facet:{data:i,name:"value",groupby:"index"}},p,He(v,g,we),[s,u])).sort=c,e}const at='item.orient === "left"',rt='item.orient === "right"',lt=`(${at} || ${rt})`,ot=`datum.vgrad && ${lt}`,st=Je('"top"','"bottom"','"middle"'),ut=`datum.vgrad && ${rt} ? (${Je('"right"','"left"','"center"')}) : (${lt} && !(datum.vgrad && ${at})) ? "left" : ${Ke}`,dt=`item._anchor || (${lt} ? "middle" : "start")`,ct=`${ot} ? (${at} ? -90 : 90) : 0`,ft=`${lt} ? (datum.vgrad ? (${rt} ? "bottom" : "top") : ${st}) : "top"`;function gt(e,n){var i;return t.isObject(e)&&(e.signal?i=e.signal:e.path?i="pathShape("+pt(e.path)+")":e.sphere&&(i="geoShape("+pt(e.sphere)+', {type: "Sphere"})')),i?n.signalRef(i):!!e}function pt(e){return t.isObject(e)&&e.signal?e.signal:t.stringValue(e)}function mt(e){var t=e.role||"";return t.indexOf("axis")&&t.indexOf("legend")&&t.indexOf("title")?"group"===e.type?"scope":t||"mark":t}function ht(e){return{marktype:e.type,name:e.name||void 0,role:e.role||mt(e),zindex:+e.zindex||void 0}}function yt(e,t){return e&&e.signal?t.signalRef(e.signal):!1!==e}function bt(e,n){var i=l.definition(e.type);i||t.error("Unrecognized transform type: "+t.stringValue(e.type));var a=g(i.type.toLowerCase(),null,vt(i,e,n));return e.signal&&n.addSignal(e.signal,n.proxy(a)),a.metadata=i.metadata||{},a}function vt(e,t,n){var i,a,r,l={};for(a=0,r=e.params.length;a<r;++a)l[(i=e.params[a]).name]=xt(i,t,n);return l}function xt(e,n,i){var a=e.type,r=n[e.name];return"index"===a?function(e,n,i){t.isString(n.from)||t.error('Lookup "from" parameter must be a string literal.');return i.getData(n.from).lookupRef(i,n.key)}(0,n,i):void 0!==r?"param"===a?function(e,n,i){var a=n[e.name];return e.array?(t.isArray(a)||t.error("Expected an array of sub-parameters. Instead: "+t.stringValue(a)),a.map((function(t){return St(e,t,i)}))):St(e,a,i)}(e,n,i):"projection"===a?i.projectionRef(n[e.name]):e.array&&!x(r)?r.map((function(t){return kt(e,t,i)})):kt(e,r,i):void(e.required&&t.error("Missing required "+t.stringValue(n.type)+" parameter: "+t.stringValue(e.name)))}function kt(e,n,i){var a=e.type;if(x(n))return $t(a)?t.error("Expression references can not be signals."):Ot(a)?i.fieldRef(n):Rt(a)?i.compareRef(n):i.signalRef(n.signal);var r,l=e.expr||Ot(a);return l&&((r=n)&&r.expr)?i.exprRef(n.expr,n.as):l&&function(e){return e&&e.field}(n)?h(n.field,n.as):$t(a)?c(n,i):function(e){return"data"===e}(a)?m(i.getData(n).values):Ot(a)?h(n):Rt(a)?i.compareRef(n):n}function St(e,n,i){var a,r,l,o,s;for(o=0,s=e.params.length;o<s;++o){for(l in(r=e.params[o]).key)if(r.key[l]!==n[l]){r=null;break}if(r)break}return r||t.error("Unsupported parameter: "+t.stringValue(n)),a=t.extend(vt(r,n,i),r.key),m(i.add(J(a)))}function $t(e){return"expr"===e}function Ot(e){return"field"===e}function Rt(e){return"compare"===e}function zt(e,t){return e.$ref?e:e.data&&e.data.$ref?e.data:m(t.getData(e.data).output)}function wt(e,t,n,i,a){this.scope=e,this.input=t,this.output=n,this.values=i,this.aggregate=a,this.index={}}wt.fromEntries=function(e,t){var n=t.length,i=1,a=t[0],r=t[n-1],l=t[n-2],o=null;for(a&&"load"===a.type&&(a=t[1]),e.add(t[0]);i<n;++i)t[i].params.pulse=m(t[i-1]),e.add(t[i]),"aggregate"===t[i].type&&(o=t[i]);return new wt(e,a,l,r,o)};var jt=wt.prototype;function Pt(e){return t.isString(e)?e:null}function Dt(e,t,n){var i,a=v(n.op,n.field);if(t.ops){for(var r=0,l=t.as.length;r<l;++r)if(t.as[r]===a)return}else t.ops=["count"],t.fields=[null],t.as=["count"];n.op&&(t.ops.push((i=n.op.signal)?e.signalRef(i):n.op),t.fields.push(e.fieldRef(n.field)),t.as.push(a))}function Vt(e,n,i,a,r,l,o){var s,u,d=n[i]||(n[i]={}),c=function(e){return t.isObject(e)?("descending"===e.order?"-":"+")+v(e.op,e.field):""}(l),f=Pt(r);if(null!=f&&(e=n.scope,s=d[f+=c?"|"+c:""]),!s){var p=l?{field:y,pulse:n.countsRef(e,r,l)}:{field:e.fieldRef(r),pulse:m(n.output)};c&&(p.sort=e.sortRef(l)),u=e.add(g(a,void 0,p)),o&&(n.index[r]=u),s=m(u),null!=f&&(d[f]=s)}return s}function Wt(e,t,n){var i,a=e.remove,r=e.insert,l=e.toggle,o=e.modify,s=e.values,u=t.add(p());i=c("if("+e.trigger+',modify("'+n+'",'+[r,a,l,o,s].map((function(e){return null==e?"null":e})).join(",")+"),0)",t),u.update=i.$expr,u.params=i.$params}function _t(e,n){var i,a,r,l,o,s,u,d,c,f,g,p,y,b,v=mt(e),k="group"===e.type,S=e.from&&e.from.facet,$=e.layout||"scope"===v||"frame"===v,O="mark"===v||$||S,R=e.overlap;r=function(e,n,i){var a,r,l,o,s;return e?(a=e.facet)&&(n||t.error("Only group marks can be faceted."),null!=a.field?o=s=zt(a,i):(e.data?s=m(i.getData(e.data).aggregate):((l=bt(t.extend({type:"aggregate",groupby:t.array(a.groupby)},a.aggregate),i)).params.key=i.keyRef(a.groupby),l.params.pulse=zt(a,i),o=s=m(i.add(l))),r=i.keyRef(a.groupby,!0))):o=m(i.add(A(null,[{}]))),o||(o=zt(e,i)),{key:r,pulse:o,parent:s}}(e.from,k,n),f=m(a=n.add(T({key:r.key||(e.key?h(e.key):void 0),pulse:r.pulse,clean:!k}))),a=l=n.add(A({pulse:f})),a=n.add(G({markdef:ht(e),interactive:yt(e.interactive,n),clip:gt(e.clip,n),context:{$context:!0},groups:n.lookup(),parent:n.signals.parent?n.signalRef("parent"):null,index:n.markpath(),pulse:m(a)})),g=m(a),(a=o=n.add(B(Ie(e.encode,e.type,v,e.style,n,{mod:!1,pulse:g})))).params.parent=n.encode(),e.transform&&e.transform.forEach((function(e){const i=bt(e,n),r=i.metadata;(r.generates||r.changes)&&t.error("Mark transforms should not generate new data."),r.nomod||(o.params.mod=!0),i.params.pulse=m(a),n.add(a=i)})),e.sort&&(a=n.add(re({sort:n.compareRef(e.sort),pulse:m(a)}))),p=m(a),(S||$)&&(y=m($=n.add(le({layout:n.objectProperty(e.layout),legends:n.legends,mark:g,pulse:p})))),b=m(s=n.add(E({mark:g,pulse:y||p}))),k&&(O&&((i=n.operators).pop(),$&&i.pop()),n.pushState(p,y||b,f),S?function(e,n,i){var a,r,l,o,s=e.from.facet,u=s.name,d=zt(s,n);s.name||t.error("Facet must have a name: "+t.stringValue(s)),s.data||t.error("Facet must reference a data set: "+t.stringValue(s)),s.field?o=n.add(K({field:n.fieldRef(s.field),pulse:d})):s.groupby?o=n.add(M({key:n.keyRef(s.groupby),group:m(n.proxy(i.parent)),pulse:d})):t.error("Facet must specify groupby or field: "+t.stringValue(s)),r=(a=n.fork()).add(A()),l=a.add(ae({pulse:m(r)})),a.addData(u,new wt(a,r,r,l)),a.addSignal("parent",null),o.params.subflow={$subflow:Ht(e,a).toRuntime()}}(e,n,r):O?function(e,t,n){var i=t.add(K({pulse:n.pulse})),a=t.fork();a.add(ae()),a.addSignal("parent",null),i.params.subflow={$subflow:Ht(e,a).toRuntime()}}(e,n,r):Ht(e,n),n.popState(),O&&($&&i.push($),i.push(s))),R&&(b=function(e,t,n){var i,a=e.method,r=e.bound,l=e.separation,o={separation:x(l)?n.signalRef(l.signal):l,method:x(a)?n.signalRef(a.signal):a,pulse:t};e.order&&(o.sort=n.compareRef({field:e.order}));r&&(i=r.tolerance,o.boundTolerance=x(i)?n.signalRef(i.signal):+i,o.boundScale=n.scaleRef(r.scale),o.boundOrient=r.orient);return m(n.add(Q(o)))}(R,b,n)),u=n.add(ne({pulse:b})),d=n.add(ae({pulse:m(u)},void 0,n.parent())),null!=e.name&&(c=e.name,n.addData(c,new wt(n,l,u,d)),e.on&&e.on.forEach((function(e){(e.insert||e.remove||e.toggle)&&t.error("Marks only support modify triggers."),Wt(e,n,c)})))}function Ct(e,n){var i,a,l,o,s,u,d,f,g,p=n.config.legend,h=e.encode||{},y=h.legend||{},b=y.name||void 0,v=y.interactive,x=y.style,k=Ye(e,p),S=ze.reduce((function(t,n){return t||e[n]}),0);return S||t.error("Missing valid scale for legend."),s=function(e,t){var n=e.type||"symbol";e.type||1!==function(e){return ze.reduce((function(t,n){return t+(e[n]?1:0)}),0)}(e)||!e.fill&&!e.stroke||(n=r.isContinuous(t)?"gradient":r.isDiscretizing(t)?"discrete":"symbol");return"gradient"!==n?n:r.isDiscretizing(t)?"discrete":"gradient"}(e,n.scaleType(S)),u={title:null!=e.title,type:s,vgrad:"symbol"!==s&&k.isVertical()},d=m(n.add(A(null,[u]))),y=He(function(e,t){var n={enter:{},update:{}};return Ue(n,{orient:e("orient"),offset:e("offset"),padding:e("padding"),titlePadding:e("titlePadding"),cornerRadius:e("cornerRadius"),fill:e("fillColor"),stroke:e("strokeColor"),strokeWidth:t.strokeWidth,strokeDash:t.strokeDash,x:e("legendX"),y:e("legendY")}),n}(k,p),y,we),i={enter:{x:{value:0},y:{value:0}}},f=m(n.add(I(l={type:s,scale:n.scaleRef(S),count:n.objectProperty(k("tickCount")),limit:n.property(k("symbolLimit")),values:n.objectProperty(e.values),minstep:n.property(e.tickMinStep),formatType:n.property(e.formatType),formatSpecifier:n.property(e.format)}))),"gradient"===s?(o=[Ze(e,S,p,h.gradient),tt(e,p,h.labels,f)],l.count=l.count||n.signalRef(`max(2,2*floor((${$(k.gradientLength())})/100))`)):"discrete"===s?o=[et(e,S,p,h.gradient,f),tt(e,p,h.labels,f)]:(a=function(e,t){const n=Ye(e,t);return{align:n("gridAlign"),columns:n.entryColumns(),center:{row:!0,column:!1},padding:{row:n("rowPadding"),column:n("columnPadding")}}}(e,p),o=[it(e,p,h,f,$(a.columns))],l.size=function(e,t,n){var i=$(Lt("size",e,n)),a=$(Lt("strokeWidth",e,n)),r=$(function(e,t,n){return Qe("fontSize",e)||function(e,t,n){var i=t.config.style[n];return i&&i[e]}("fontSize",t,n)}(n[1].encode,t,"guide-label"));return c(`max(ceil(sqrt(${i})+${a}),${r})`,t)}(e,n,o[0].marks)),o=[nt("legend-entry",null,null,d,v,i,o,a)],u.title&&o.push(function(e,t,n,i){var a,r=Ye(e,t);return Ue(a={enter:{opacity:je},update:{opacity:Pe,x:{field:{group:"padding"}},y:{field:{group:"padding"}}},exit:{opacity:je}},{orient:r("titleOrient"),_anchor:r("titleAnchor"),anchor:{signal:dt},angle:{signal:ct},align:{signal:ut},baseline:{signal:ft},text:e.title,fill:r("titleColor"),fillOpacity:r("titleOpacity"),font:r("titleFont"),fontSize:r("titleFontSize"),fontStyle:r("titleFontStyle"),fontWeight:r("titleFontWeight"),limit:r("titleLimit"),lineHeight:r("titleLineHeight")},{align:r("titleAlign"),baseline:r("titleBaseline")}),Xe("text","legend-title","guide-title",null,i,a,n)}(e,p,h.title,d)),g=nt("legend",x,b,d,v,y,o),e.zindex&&(g.zindex=e.zindex),_t(g,n)}function Lt(e,t,n){return t[e]?`scale("${t[e]}",datum)`:Qe(e,n[0].encode)}jt.countsRef=function(e,t,n){var i,a,r,l=this.counts||(this.counts={}),o=Pt(t);return null!=o&&(e=this.scope,i=l[o]),i?n&&n.field&&Dt(e,i.agg.params,n):(r={groupby:e.fieldRef(t,"key"),pulse:m(this.output)},n&&n.field&&Dt(e,r,n),a=e.add(C(r)),i=e.add(A({pulse:m(a)})),i={agg:a,ref:m(i)},null!=o&&(l[o]=i)),i.ref},jt.tuplesRef=function(){return m(this.values)},jt.extentRef=function(e,t){return Vt(e,this,"extent","extent",t,!1)},jt.domainRef=function(e,t){return Vt(e,this,"domain","values",t,!1)},jt.valuesRef=function(e,t,n){return Vt(e,this,"vals","values",t,n||!0)},jt.lookupRef=function(e,t){return Vt(e,this,"lookup","tupleindex",t,!1)},jt.indataRef=function(e,t){return Vt(e,this,"indata","tupleindex",t,!0,!0)};function Et(e,n){var i,a,r=Ye(e=t.isString(e)?{text:e}:e,n.config.title),l=e.encode||{},o=l.group||{},s=o.name||void 0,u=o.interactive,d=o.style,c=[];return i=m(n.add(A(null,[{}]))),c.push(function(e,t,n,i){var a={value:0},r=e.text,l={enter:{opacity:a},update:{opacity:{value:1}},exit:{opacity:a}};return Ue(l,{text:r,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:t("dx"),dy:t("dy"),fill:t("color"),font:t("font"),fontSize:t("fontSize"),fontStyle:t("fontStyle"),fontWeight:t("fontWeight"),lineHeight:t("lineHeight")},{align:t("align"),angle:t("angle"),baseline:t("baseline")}),Xe("text","title-text","group-title",null,i,l,n)}(e,r,function(e){const n=e.encode;return n&&n.title||t.extend({name:e.name,interactive:e.interactive,style:e.style},n)}(e),i)),e.subtitle&&c.push(function(e,t,n,i){var a={value:0},r=e.subtitle,l={enter:{opacity:a},update:{opacity:{value:1}},exit:{opacity:a}};return Ue(l,{text:r,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:t("dx"),dy:t("dy"),fill:t("subtitleColor"),font:t("subtitleFont"),fontSize:t("subtitleFontSize"),fontStyle:t("subtitleFontStyle"),fontWeight:t("subtitleFontWeight"),lineHeight:t("subtitleLineHeight")},{align:t("align"),angle:t("angle"),baseline:t("baseline")}),Xe("text","title-subtitle","group-subtitle",null,i,l,n)}(e,r,l.subtitle,i)),a=nt("title",d,s,i,u,function(e,t){var n={enter:{},update:{}};return Ue(n,{orient:e("orient"),anchor:e("anchor"),align:{signal:Ke},angle:{signal:'item.orient==="left"?-90:item.orient==="right"?90:0'},limit:e("limit"),frame:e("frame"),offset:e("offset")||0,padding:e("subtitlePadding")}),He(n,t,we)}(r,o),c),e.zindex&&(a.zindex=e.zindex),_t(a,n)}function At(e,n){var i=[];e.transform&&e.transform.forEach((function(e){i.push(bt(e,n))})),e.on&&e.on.forEach((function(t){Wt(t,n,e.name)})),n.addDataPipeline(e.name,function(e,n,i){var a,r,l,o,s,u=[],d=null,c=!1,f=!1;e.values?k(e.values)||k(e.format)?(u.push(Tt(n,e)),u.push(d=Ft())):u.push(d=Ft({$ingest:e.values,$format:e.format})):e.url?k(e.url)||k(e.format)?(u.push(Tt(n,e)),u.push(d=Ft())):u.push(d=Ft({$request:e.url,$format:e.format})):e.source&&(d=a=t.array(e.source).map((function(e){return m(n.getData(e).output)})),u.push(null));for(r=0,l=i.length;r<l;++r)o=i[r],s=o.metadata,d||s.source||u.push(d=Ft()),u.push(o),s.generates&&(f=!0),s.modifies&&!f&&(c=!0),s.source?d=o:s.changes&&(d=null);a&&(l=a.length-1,u[0]=te({derive:c,pulse:l?a:a[0]}),(c||l)&&u.splice(1,0,Ft()));d||u.push(Ft());return u.push(ae({})),u}(e,n,i))}function Ft(e){var t=A({},e);return t.metadata={source:!0},t}function Tt(e,t){return N({url:t.url?e.property(t.url):void 0,async:t.async?e.property(t.async):void 0,values:t.values?e.property(t.values):void 0,format:e.objectProperty(t.format)})}function Bt(e,t){return{scale:e.scale,range:t}}function qt(e,n,i,a,r){var l,o,s,u,d,c,f,g,p,m=Ye(e,n),h=e.orient,y=e.gridScale,b=h===Oe||h===$e?1:-1,v=function(e,n){if(1===n);else if(t.isObject(e)){for(var i=e=t.extend({},e);null!=i.mult;){if(!t.isObject(i.mult))return i.mult*=n,e;i=i.mult=t.extend({},i.mult)}i.mult=n}else e=n*(e||0);return e}(e.offset,b);return Ue(l={enter:o={opacity:je},update:u={opacity:Pe},exit:s={opacity:je}},{stroke:m("gridColor"),strokeDash:m("gridDash"),strokeDashOffset:m("gridDashOffset"),strokeOpacity:m("gridOpacity"),strokeWidth:m("gridWidth")}),d={scale:e.scale,field:Re,band:r.band,extra:r.extra,offset:r.offset,round:m("tickRound")},h===$e||"bottom"===h?(c="x",f="y",p="height"):(c="y",f="x",p="width"),g=f+"2",u[c]=o[c]=s[c]=d,y?(u[f]=o[f]={scale:y,range:0,mult:b,offset:v},u[g]=o[g]={scale:y,range:1,mult:b,offset:v}):(u[f]=o[f]={value:0,offset:v},u[g]=o[g]={signal:p,mult:b,offset:v}),Xe("rule","axis-grid",null,Re,a,l,i)}function Mt(e,t,n,i,a){return{signal:'flush(range("'+e+'"), scale("'+e+'", datum.value), '+t+","+n+","+i+","+a+")"}}function Ut(e,n){var i,a,r,l,o,s,u=function(e,n){var i=n.config,a=e.orient,r=a===$e||"bottom"===a?i.axisX:i.axisY,l=i["axis"+a[0].toUpperCase()+a.slice(1)],o="band"===n.scaleType(e.scale)&&i.axisBand;return r||l||o?t.extend({},i.axis,r,l,o):i.axis}(e,n),d=e.encode||{},c=d.axis||{},f=c.name||void 0,g=c.interactive,p=c.style,h=Ye(e,u),y=function(e){let n,i,a=e("tickBand"),r=e("tickOffset");return a?a.signal?(n={signal:`(${a.signal})==='extent'?1:0.5`},i={signal:`(${a.signal})==='extent'?true:false`},t.isObject(r)||(r={signal:`(${a.signal})==='extent'?0:${r}`})):"extent"===a?(n=1,i=!0,r=0):(n=.5,i=!1):(n=e("bandPosition"),i=e("tickExtra")),{extra:i,band:n,offset:r}}(h);return i={orient:e.orient,ticks:!!h("ticks"),labels:!!h("labels"),grid:!!h("grid"),domain:!!h("domain"),title:null!=e.title,translate:h("translate")},a=m(n.add(A({},[i]))),c=He({update:{offset:qe(h("offset")||0),position:qe(S(e.position,0)),titlePadding:qe(h("titlePadding")),minExtent:qe(h("minExtent")),maxExtent:qe(h("maxExtent")),range:{signal:`abs(span(range("${e.scale}")))`}}},d.axis,we),r=m(n.add(L({scale:n.scaleRef(e.scale),extra:n.property(y.extra),count:n.objectProperty(e.tickCount),values:n.objectProperty(e.values),minstep:n.property(e.tickMinStep),formatType:n.property(e.formatType),formatSpecifier:n.property(e.format)}))),s=[],i.grid&&s.push(qt(e,u,d.grid,r,y)),i.ticks&&(l=h("tickSize"),s.push(function(e,t,n,i,a,r){var l,o,s,u,d,c,f=Ye(e,t),g=e.orient,p=g===Oe||g===$e?-1:1;return Ue(l={enter:o={opacity:je},update:u={opacity:Pe},exit:s={opacity:je}},{stroke:f("tickColor"),strokeDash:f("tickDash"),strokeDashOffset:f("tickDashOffset"),strokeOpacity:f("tickOpacity"),strokeWidth:f("tickWidth")}),(d=qe(a)).mult=p,c={scale:e.scale,field:Re,band:r.band,extra:r.extra,offset:r.offset,round:f("tickRound")},g===$e||"bottom"===g?(u.y=o.y=je,u.y2=o.y2=d,u.x=o.x=s.x=c):(u.x=o.x=je,u.x2=o.x2=d,u.y=o.y=s.y=c),Xe("rule","axis-tick",null,Re,i,l,n)}(e,u,d.ticks,r,l,y))),i.labels&&(l=i.ticks?l:0,s.push(function(e,t,n,i,a,r){var l,o,s,u,d,c,f,g,p,m,h=Ye(e,t),y=e.orient,b=y===Oe||y===$e?-1:1,v=y===$e||"bottom"===y,x=e.scale,k=$(h("labelFlush")),S=$(h("labelFlushOffset")),O=0===k||!!k,R=h("labelAlign"),z=h("labelBaseline");return(s=qe(a)).mult=b,s.offset=qe(h("labelPadding")||0),s.offset.mult=b,u={scale:x,field:Re,band:.5,offset:r.offset},v?(d=R||(O?Mt(x,k,'"left"','"right"','"center"'):"center"),c=z||(y===$e?"bottom":"top"),f=!R):(d=R||("right"===y?"left":"right"),c=z||(O?Mt(x,k,'"top"','"bottom"','"middle"'):"middle"),f=!z),f=f&&O&&S?Mt(x,k,"-("+S+")",S,0):null,Ue(l={enter:o={opacity:je,x:v?u:s,y:v?s:u},update:{opacity:Pe,text:{field:"label"},x:o.x,y:o.y},exit:{opacity:je,x:o.x,y:o.y}},{[v?"dx":"dy"]:f,align:d,baseline:c,angle:h("labelAngle"),fill:h("labelColor"),fillOpacity:h("labelOpacity"),font:h("labelFont"),fontSize:h("labelFontSize"),fontWeight:h("labelFontWeight"),fontStyle:h("labelFontStyle"),limit:h("labelLimit")}),g=h("labelBound"),p=h("labelOverlap"),m=h("labelSeparation"),e=Xe("text","axis-label","guide-label",Re,i,l,n),(p||g)&&(e.overlap={separation:m,method:p,order:"datum.index",bound:g?{scale:x,orient:y,tolerance:g}:null}),e}(e,u,d.labels,r,l,y))),i.domain&&s.push(function(e,t,n,i){var a,r,l,o,s,u,d=Ye(e,t),c=e.orient;return Ue(a={enter:r={opacity:je},update:l={opacity:Pe},exit:{opacity:je}},{stroke:d("domainColor"),strokeDash:d("domainDash"),strokeDashOffset:d("domainDashOffset"),strokeWidth:d("domainWidth"),strokeOpacity:d("domainOpacity")}),c===$e||"bottom"===c?(o="x",u="y"):(o="y",u="x"),s=o+"2",r[u]=je,l[o]=r[o]=Bt(e,0),l[s]=r[s]=Bt(e,1),Xe("rule","axis-domain",null,null,i,a,n)}(e,u,d.domain,a)),i.title&&s.push(function(e,n,i,a){var r,l,o,s,u=Ye(e,n),d=e.orient,c=d===Oe||d===$e?-1:1,f=d===$e||"bottom"===d;return r={enter:l={opacity:je,anchor:qe(u("titleAnchor")),align:{signal:Ke}},update:o=t.extend({},l,{opacity:Pe,text:qe(e.title)}),exit:{opacity:je}},s={signal:`lerp(range("${e.scale}"), ${Je(0,1,.5)})`},f?(o.x=s,l.angle={value:0},l.baseline={value:d===$e?"bottom":"top"}):(o.y=s,l.angle={value:90*c},l.baseline={value:"bottom"}),Ue(r,{angle:u("titleAngle"),baseline:u("titleBaseline"),fill:u("titleColor"),fillOpacity:u("titleOpacity"),font:u("titleFont"),fontSize:u("titleFontSize"),fontStyle:u("titleFontStyle"),fontWeight:u("titleFontWeight"),limit:u("titleLimit"),lineHeight:u("titleLineHeight")},{align:u("titleAlign")}),!Me(r,"x",u("titleX"),"update")&&!f&&!Ge("x",i)&&(r.enter.auto={value:!0}),!Me(r,"y",u("titleY"),"update")&&f&&!Ge("y",i)&&(r.enter.auto={value:!0}),Xe("text","axis-title","guide-title",null,a,r,i)}(e,u,d.title,a)),o=nt("axis",p,f,a,g,c,s),e.zindex&&(o.zindex=e.zindex),_t(o,n)}function Ht(e,n,i){var a=t.array(e.signals),l=t.array(e.scales);return i||a.forEach(e=>d(e,n)),t.array(e.projections).forEach(e=>function(e,t){var n=t.config.projection||{},i={};for(var a in e)"name"!==a&&(i[a]=Se(e[a],a,t));for(a in n)null==i[a]&&(i[a]=Se(n[a],a,t));t.addProjection(e.name,i)}(e,n)),l.forEach(e=>function(e,n){var i=e.type||"linear";r.isValidScaleType(i)||t.error("Unrecognized scale type: "+t.stringValue(i)),n.addScale(e.name,{type:i,domain:void 0})}(e,n)),t.array(e.data).forEach(e=>At(e,n)),l.forEach(e=>de(e,n)),(i||a).forEach(e=>W(e,n)),t.array(e.axes).forEach(e=>Ut(e,n)),t.array(e.marks).forEach(e=>_t(e,n)),t.array(e.legends).forEach(e=>Ct(e,n)),e.title&&Et(e.title,n),n.parseLambdas(),n}var It=t.toSet(["width","height","padding","autosize"]);function Nt(e,n){var i,a,r,l,s,u,c=n.config;return n.background=e.background||c.background,n.eventConfig=c.events,s=m(n.root=n.add(p())),n.addSignal("width",e.width||0),n.addSignal("height",e.height||0),n.addSignal("padding",function(e,n){return e=e||n.padding,t.isObject(e)?{top:o(e.top),bottom:o(e.bottom),left:o(e.left),right:o(e.right)}:{top:i=o(e),bottom:i,left:i,right:i};var i}(e.padding,c)),n.addSignal("autosize",function(e,n){return e=e||n.autosize,t.isObject(e)?e:{type:e||"pad"}}(e.autosize,c)),n.legends=n.objectProperty(c.legend&&c.legend.layout),u=function(e,n,i){if(t.array(n).forEach(t=>{It[t.name]||d(t,e)}),!i)return n;const a=t.array(n).slice();return t.array(i).forEach(t=>{e.hasOwnSignal(t.name)||(d(t,e),a.push(t))}),a}(n,e.signals,c.signals),a=n.add(A()),r=He({enter:{x:{value:0},y:{value:0}},update:{width:{signal:"width"},height:{signal:"height"}}},e.encode),r=n.add(B(Ie(r,"group","frame",e.style,n,{pulse:m(a)}))),l=n.add(le({layout:n.objectProperty(e.layout),legends:n.legends,autosize:n.signalRef("autosize"),mark:s,pulse:m(r)})),n.operators.pop(),n.pushState(m(r),m(l),null),Ht(e,n,u),n.operators.push(l),i=n.add(E({mark:s,pulse:m(l)})),i=n.add(ne({pulse:m(i)})),i=n.add(ae({pulse:m(i)})),n.addData("root",new wt(n,a,a,i)),n}function Gt(e){this.config=e,this.bindings=[],this.field={},this.signals={},this.lambdas={},this.scales={},this.events={},this.data={},this.streams=[],this.updates=[],this.operators=[],this.background=null,this.eventConfig=null,this._id=0,this._subid=0,this._nextsub=[0],this._parent=[],this._encode=[],this._lookup=[],this._markpath=[]}function Xt(e){this.config=e.config,this.legends=e.legends,this.field=Object.create(e.field),this.signals=Object.create(e.signals),this.lambdas=Object.create(e.lambdas),this.scales=Object.create(e.scales),this.events=Object.create(e.events),this.data=Object.create(e.data),this.streams=[],this.updates=[],this.operators=[],this._id=0,this._subid=++e._nextsub[0],this._nextsub=e._nextsub,this._parent=e._parent.slice(),this._encode=e._encode.slice(),this._lookup=e._lookup.slice(),this._markpath=e._markpath}var Yt=Gt.prototype=Xt.prototype;function Qt(e){return(t.isArray(e)?Jt:Kt)(e)}function Jt(e){for(var n,i="[",a=0,r=e.length;a<r;++a)n=e[a],i+=(a>0?",":"")+(t.isObject(n)?n.signal||Qt(n):t.stringValue(n));return i+"]"}function Kt(e){var n,i,a="{",r=0;for(n in e)i=e[n],a+=(++r>1?",":"")+t.stringValue(n)+":"+(t.isObject(i)?i.signal||Qt(i):t.stringValue(i));return a+"}"}Yt.fork=function(){return new Xt(this)},Yt.isSubscope=function(){return this._subid>0},Yt.toRuntime=function(){return this.finish(),{background:this.background,operators:this.operators,streams:this.streams,updates:this.updates,bindings:this.bindings,eventConfig:this.eventConfig}},Yt.id=function(){return(this._subid?this._subid+":":0)+this._id++},Yt.add=function(e){return this.operators.push(e),e.id=this.id(),e.refs&&(e.refs.forEach((function(t){t.$ref=e.id})),e.refs=null),e},Yt.proxy=function(e){var t=e instanceof f?m(e):e;return this.add(ee({value:t}))},Yt.addStream=function(e){return this.streams.push(e),e.id=this.id(),e},Yt.addUpdate=function(e){return this.updates.push(e),e},Yt.finish=function(){var e,t;for(e in this.root&&(this.root.root=!0),this.signals)this.signals[e].signal=e;for(e in this.scales)this.scales[e].scale=e;function n(e,t,n){var i;e&&((i=e.data||(e.data={}))[t]||(i[t]=[])).push(n)}for(e in this.data)for(var i in n((t=this.data[e]).input,e,"input"),n(t.output,e,"output"),n(t.values,e,"values"),t.index)n(t.index[i],e,"index:"+i);return this},Yt.pushState=function(e,t,n){this._encode.push(m(this.add(ae({pulse:e})))),this._parent.push(t),this._lookup.push(n?m(this.proxy(n)):null),this._markpath.push(-1)},Yt.popState=function(){this._encode.pop(),this._parent.pop(),this._lookup.pop(),this._markpath.pop()},Yt.parent=function(){return t.peek(this._parent)},Yt.encode=function(){return t.peek(this._encode)},Yt.lookup=function(){return t.peek(this._lookup)},Yt.markpath=function(){var e=this._markpath;return++e[e.length-1]},Yt.fieldRef=function(e,n){if(t.isString(e))return h(e,n);e.signal||t.error("Unsupported field reference: "+t.stringValue(e));var i,a=e.signal,r=this.field[a];return r||(i={name:this.signalRef(a)},n&&(i.as=n),this.field[a]=r=m(this.add(U(i)))),r},Yt.compareRef=function(e){function n(e){return x(e)?(a=!0,i.signalRef(e.signal)):function(e){return e&&e.expr}(e)?(a=!0,i.exprRef(e.expr)):e}var i=this,a=!1,r=t.array(e.field).map(n),l=t.array(e.order).map(n);return a?m(this.add(F({fields:r,orders:l}))):b(r,l)},Yt.keyRef=function(e,n){var i=this.signals,a=!1;return e=t.array(e).map((function(e){return x(e)?(a=!0,m(i[e.signal])):e})),a?m(this.add(H({fields:e,flat:n}))):function(e,t){var n={$key:e};return t&&(n.$flat=!0),n}(e,n)},Yt.sortRef=function(e){if(!e)return e;var t=v(e.op,e.field),n=e.order||"ascending";return n.signal?m(this.add(F({fields:t,orders:this.signalRef(n.signal)}))):b(t,n)},Yt.event=function(e,t){var n=e+":"+t;if(!this.events[n]){var i=this.id();this.streams.push({id:i,source:e,type:t}),this.events[n]=i}return this.events[n]},Yt.hasOwnSignal=function(e){return t.hasOwnProperty(this.signals,e)},Yt.addSignal=function(e,n){this.hasOwnSignal(e)&&t.error("Duplicate signal name: "+t.stringValue(e));var i=n instanceof f?n:this.add(p(n));return this.signals[e]=i},Yt.getSignal=function(e){return this.signals[e]||t.error("Unrecognized signal name: "+t.stringValue(e)),this.signals[e]},Yt.signalRef=function(e){return this.signals[e]?m(this.signals[e]):(t.hasOwnProperty(this.lambdas,e)||(this.lambdas[e]=this.add(p(null))),m(this.lambdas[e]))},Yt.parseLambdas=function(){for(var e=Object.keys(this.lambdas),t=0,n=e.length;t<n;++t){var i=e[t],a=c(i,this),r=this.lambdas[i];r.params=a.$params,r.update=a.$expr}},Yt.property=function(e){return e&&e.signal?this.signalRef(e.signal):e},Yt.objectProperty=function(e){return e&&t.isObject(e)?this.signalRef(e.signal||Qt(e)):e},Yt.exprRef=function(e,t){var n={expr:c(e,this)};return t&&(n.expr.$name=t),m(this.add(q(n)))},Yt.addBinding=function(e,n){this.bindings||t.error("Nested signals do not support binding: "+t.stringValue(e)),this.bindings.push(t.extend({signal:e},n))},Yt.addScaleProj=function(e,n){t.hasOwnProperty(this.scales,e)&&t.error("Duplicate scale or projection name: "+t.stringValue(e)),this.scales[e]=this.add(n)},Yt.addScale=function(e,t){this.addScaleProj(e,ie(t))},Yt.addProjection=function(e,t){this.addScaleProj(e,Z(t))},Yt.getScale=function(e){return this.scales[e]||t.error("Unrecognized scale name: "+t.stringValue(e)),this.scales[e]},Yt.projectionRef=Yt.scaleRef=function(e){return m(this.getScale(e))},Yt.projectionType=Yt.scaleType=function(e){return this.getScale(e).params.type},Yt.addData=function(e,n){return t.hasOwnProperty(this.data,e)&&t.error("Duplicate data set name: "+t.stringValue(e)),this.data[e]=n},Yt.getData=function(e){return this.data[e]||t.error("Undefined data set name: "+t.stringValue(e)),this.data[e]},Yt.addDataPipeline=function(e,n){return t.hasOwnProperty(this.data,e)&&t.error("Duplicate data set name: "+t.stringValue(e)),this.addData(e,wt.fromEntries(this,n))};function Zt(){return{padding:0,autosize:"pad",background:null,events:{defaults:{allow:["wheel"]}},group:null,mark:null,arc:{fill:"#4c78a8"},area:{fill:"#4c78a8"},image:null,line:{stroke:"#4c78a8",strokeWidth:2},path:{stroke:"#4c78a8"},rect:{fill:"#4c78a8"},rule:{stroke:"#000"},shape:{stroke:"#4c78a8"},symbol:{fill:"#4c78a8",size:64},text:{fill:"#000",font:"sans-serif",fontSize:11},style:{"guide-label":{fill:"#000",font:"sans-serif",fontSize:10},"guide-title":{fill:"#000",font:"sans-serif",fontSize:11,fontWeight:"bold"},"group-title":{fill:"#000",font:"sans-serif",fontSize:13,fontWeight:"bold"},"group-subtitle":{fill:"#000",font:"sans-serif",fontSize:12},point:{size:30,strokeWidth:2,shape:"circle"},circle:{size:30,strokeWidth:2},square:{size:30,strokeWidth:2,shape:"square"},cell:{fill:"transparent",stroke:"#ddd"}},title:{orient:"top",anchor:"middle",offset:4,subtitlePadding:3},axis:{minExtent:0,maxExtent:200,bandPosition:.5,domain:!0,domainWidth:1,domainColor:"#888",grid:!1,gridWidth:1,gridColor:"#ddd",labels:!0,labelAngle:0,labelLimit:180,labelPadding:2,ticks:!0,tickColor:"#888",tickOffset:0,tickRound:!0,tickSize:5,tickWidth:1,titlePadding:4},axisBand:{tickOffset:-.5},projection:{type:"mercator"},legend:{orient:"right",padding:0,gridAlign:"each",columnPadding:10,rowPadding:2,symbolDirection:"vertical",gradientDirection:"vertical",gradientLength:200,gradientThickness:16,gradientStrokeColor:"#ddd",gradientStrokeWidth:0,gradientLabelOffset:2,labelAlign:"left",labelBaseline:"middle",labelLimit:160,labelOffset:4,labelOverlap:!0,symbolLimit:30,symbolType:"circle",symbolSize:100,symbolOffset:0,symbolStrokeWidth:1.5,symbolBaseFillColor:"transparent",symbolBaseStrokeColor:"#888",titleLimit:180,titleOrient:"top",titlePadding:5,layout:{offset:18,direction:"horizontal",left:{direction:"vertical"},right:{direction:"vertical"}}},range:{category:{scheme:"tableau10"},ordinal:{scheme:"blues"},heatmap:{scheme:"yellowgreenblue"},ramp:{scheme:"blues"},diverging:{scheme:"blueorange",extent:[1,0]},symbol:["circle","square","triangle-up","cross","diamond","triangle-right","triangle-down","triangle-left"]}}}e.AxisDomainRole="axis-domain",e.AxisGridRole="axis-grid",e.AxisLabelRole="axis-label",e.AxisRole="axis",e.AxisTickRole="axis-tick",e.AxisTitleRole="axis-title",e.DataScope=wt,e.FrameRole="frame",e.LegendEntryRole="legend-entry",e.LegendLabelRole="legend-label",e.LegendRole="legend",e.LegendSymbolRole="legend-symbol",e.LegendTitleRole="legend-title",e.MarkRole="mark",e.Scope=Gt,e.ScopeRole="scope",e.config=Zt,e.parse=function(e,n){return t.isObject(e)||t.error("Input Vega specification must be an object."),Nt(e,new Gt(n=t.mergeConfig({padding:0,autosize:"pad",background:null,events:{defaults:{allow:["wheel"]}},group:null,mark:null,arc:{fill:"#4c78a8"},area:{fill:"#4c78a8"},image:null,line:{stroke:"#4c78a8",strokeWidth:2},path:{stroke:"#4c78a8"},rect:{fill:"#4c78a8"},rule:{stroke:"#000"},shape:{stroke:"#4c78a8"},symbol:{fill:"#4c78a8",size:64},text:{fill:"#000",font:"sans-serif",fontSize:11},style:{"guide-label":{fill:"#000",font:"sans-serif",fontSize:10},"guide-title":{fill:"#000",font:"sans-serif",fontSize:11,fontWeight:"bold"},"group-title":{fill:"#000",font:"sans-serif",fontSize:13,fontWeight:"bold"},"group-subtitle":{fill:"#000",font:"sans-serif",fontSize:12},point:{size:30,strokeWidth:2,shape:"circle"},circle:{size:30,strokeWidth:2},square:{size:30,strokeWidth:2,shape:"square"},cell:{fill:"transparent",stroke:"#ddd"}},title:{orient:"top",anchor:"middle",offset:4,subtitlePadding:3},axis:{minExtent:0,maxExtent:200,bandPosition:.5,domain:!0,domainWidth:1,domainColor:"#888",grid:!1,gridWidth:1,gridColor:"#ddd",labels:!0,labelAngle:0,labelLimit:180,labelPadding:2,ticks:!0,tickColor:"#888",tickOffset:0,tickRound:!0,tickSize:5,tickWidth:1,titlePadding:4},axisBand:{tickOffset:-.5},projection:{type:"mercator"},legend:{orient:"right",padding:0,gridAlign:"each",columnPadding:10,rowPadding:2,symbolDirection:"vertical",gradientDirection:"vertical",gradientLength:200,gradientThickness:16,gradientStrokeColor:"#ddd",gradientStrokeWidth:0,gradientLabelOffset:2,labelAlign:"left",labelBaseline:"middle",labelLimit:160,labelOffset:4,labelOverlap:!0,symbolLimit:30,symbolType:"circle",symbolSize:100,symbolOffset:0,symbolStrokeWidth:1.5,symbolBaseFillColor:"transparent",symbolBaseStrokeColor:"#888",titleLimit:180,titleOrient:"top",titlePadding:5,layout:{offset:18,direction:"horizontal",left:{direction:"vertical"},right:{direction:"vertical"}}},range:{category:{scheme:"tableau10"},ordinal:{scheme:"blues"},heatmap:{scheme:"yellowgreenblue"},ramp:{scheme:"blues"},diverging:{scheme:"blueorange",extent:[1,0]},symbol:["circle","square","triangle-up","cross","diamond","triangle-right","triangle-down","triangle-left"]}},n,e.config))).toRuntime()},e.signal=d,e.signalUpdates=W,e.stream=O,Object.defineProperty(e,"__esModule",{value:!0})}));